<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Detection</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&family=Poppins:wght@500&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to right, #f9f9f9, #e1e1e1);
            color: #333;
            padding: 20px;
        }

        h1 {
            font-family: 'Roboto', sans-serif;
            text-align: center;
            margin-bottom: 20px;
            color: #333;
            font-weight: 700;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        textarea {
            font-size: 16px;
            border-radius: 8px;
            padding: 10px;
        }

        #predictButton {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
        }

        #predictButton:hover {
            background-color: #45a049;
        }

        .highest-emotion {
            font-size: 1.4em;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
        }

        /* ðŸ§  AI Agent Box */
        .agent-box {
            background-color: #ffffff;
            border-left: 6px solid #4CAF50;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            font-size: 1.1em;
            display: none;
        }
    </style>
</head>

<body>
<div class="container">
    <h1>Emotion Detection from Text</h1>

    <label for="textInput" class="form-label fw-bold">Enter text to detect emotion:</label>
    <textarea id="textInput" class="form-control" rows="4"></textarea>

    <button id="predictButton">Predict Emotion</button>

    <!-- Final Emotion -->
    <div id="highestEmotion" class="highest-emotion"></div>

    <!-- ðŸ¤– Agent Response -->
    <div id="agentResponse" class="agent-box"></div>

    <!-- Chart -->
    <div class="mt-5">
        <canvas id="emotionChart" width="400" height="250"></canvas>
    </div>
</div>

<script>
let chartInstance = null;

document.getElementById('predictButton').addEventListener('click', function () {
    const textInput = document.getElementById('textInput').value;

    if (!textInput.trim()) {
        alert("Please enter some text.");
        return;
    }

    fetch('/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: textInput })
    })
    .then(response => response.json())
    .then(data => {

        // Show final emotion
        document.getElementById('highestEmotion').innerHTML =
            `Final Emotion: <span style="text-transform: capitalize;">${data.final_emotion}</span>`;

        // Show agent response
        const agentBox = document.getElementById('agentResponse');
        agentBox.style.display = "block";
        agentBox.innerHTML = `<strong>ðŸ¤– Agent:</strong> ${data.agent_message}`;

        const labels = data.emotion_data.map(item => item.emotion);
        const probabilities = data.emotion_data.map(item => item.probability);

        if (chartInstance) {
            chartInstance.destroy();
        }

        const ctx = document.getElementById('emotionChart').getContext('2d');
        chartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Emotion Probabilities (%)',
                    data: probabilities,
                    backgroundColor: [
                        '#FF5733', '#33FF57', '#3357FF',
                        '#FF33A8', '#33FFF2', '#F0FF33', '#F33FFF'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    datalabels: {
                        anchor: 'end',
                        align: 'end',
                        formatter: value => value + '%'
                    }
                },
                indexAxis: 'y',
                scales: {
                    x: { max: 100 }
                }
            },
            plugins: [ChartDataLabels]
        });
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Error while predicting emotion.");
    });
});
</script>
</body>
</html>

